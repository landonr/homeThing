# set up your name
esphome:
  name: "homething-lilygo"
  platform: ESP32
  board: featheresp32
  on_boot:
    priority: 600.0
    then:
      - delay: 45s
      - if:
          condition:
            not:
              - wifi.connected:
          then:
            - switch.turn_on: sleep_toggle

# modify: device setup
substitutions:
  friendly_name: "homeThing example"

# menu configs: if you don't need a menu, remove it from here and in the homeThing config below

# switch menu
switch:
  # replace with your switchs
  - platform: homeassistant_switch_group
    entity_id: "switch.oven_fan"
    name: "Oven Fan"
    id: oven_fan_switch
  - platform: restart
    id: restart_switch
    name: "${friendly_name} Restart"

homeassistant_switch_group:
  # defined above with switches
  id: switch_group_component
  switches:
    - id: "oven_fan_switch"

# sensor menu
text_sensor:
  - platform: homeassistant
    entity_id: "sensor.vancouver_forecast"
    name: "Weather"
    id: sensor_weather

homeassistant_sensor_group:
  id: sensor_group_component
  sensors:
    - id: sensor_weather

# light menu
light:
  - platform: homeassistant_component
    id: light_office_lamp
    entity_id: light.office_lamp
    name: Office Lamp

# sonos favorite source
media_player_source_sonos:
  id: sonos

# media player menu
media_player:
  - platform: homeassistant_media_player
    name: Beam
    entity_id: "media_player.beam"
    id: media_player_beam
    type: speaker
    sources:
      - id: sonos
        type: sonos
  - platform: homeassistant_media_player
    name: TV
    entity_id: "media_player.55_tcl_roku_tv"
    id: media_player_tv
    type: roku
    soundbar:
      speaker: media_player_beam

homeassistant_media_player:
  id: media_group_component
  media_players:
    - id: media_player_beam
      type: speaker
    - id: media_player_tv
      type: roku

# service menu
homeassistant_service_group:
  id: service_group_component
  commands:
    - text: "desk nudge up"
      command:
        - lambda: |-
            ESP_LOGI("homeassistant_service_group", "nudge up");
        - homeassistant.service:
            service: button.press
            data:
              entity_id: "button.desk_position_nudge_up"

# homeThing config
# you only need one menu _group
homeThing:
  id: homeThingMenu
  sleep_switch: sleep_toggle #optional
  backlight: backlight #optional
  battery: #optional
    battery_percent: battery_percent
    charging: charging
   # need atleast 1 group_component or screen
  media_player_group: media_group_component
  service_group: service_group_component
  sensor_group: sensor_group_component
  switch_group: switch_group_component
  display: my_display # required
  on_redraw: # required
    then:
      component.update: my_display
  display_state:
    draw_battery_level: true # only needed if you have a battery
    # probably leave these alone
    font_small: small_font
    font_medium: medium_font
    font_large: large_font
    font_large_heavy: large_heavy_font
    font_material_large: material_font_large
    font_material_small: material_font_small
    font_logo: home_thing_logo
  screens:
    - name: Settings Screen
      show_version: True
      entities:
        - id: backlight
          type: light
        - id: "restart_switch"
          type: switch
        - id: wifi_ssid
          type: text_sensor
        - id: wifi_signal_percent
          type: sensor
        - id: wifi_ip
          type: text_sensor

# maybe modify: display setup
spi:
  clk_pin: GPIO18
  mosi_pin: GPIO19

display:
  - platform: st7789v
    model: TTGO_TDisplay_135x240
    id: my_display
    backlight_pin: GPIO4
    cs_pin: GPIO5
    dc_pin: GPIO16
    reset_pin: GPIO23
    rotation: 90
    update_interval: 10s
    lambda: |-
      id(homeThingMenu)->draw_menu_screen();
      return;

# maybe modify: include default ipod controls
packages:
  remote_package:
    url: https://github.com/landonr/homeThing
    ref: main
    files: [
      common/device_base.yaml, # defines api, ota, free memory and uptime sensor
      common/ipod/lilygo_tdisplay_ipod_backlight.yaml, # used for toggling backlight
      common/ipod/lilygo_tdisplay_ipod_battery.yaml, # used for battery percent
      common/ipod/lilygo_tdisplay_ipod_binary_sensor.yaml, # used for button controls
      common/ipod/lilygo_tdisplay_ipod_rotary.yaml, # used for rotary controls
      common/ipod/lilygo_tdisplay_ipod_sleep.yaml, # required for device to sleep
      common/fonts.yaml, # default font
      common/icon_fonts.yaml # material icons
    ]
    refresh: 0s
    
# only remove components if you aren't using the group
external_components:
  - source:
      type: git
      url: https://github.com/landonr/homeThing
    refresh: 0s
    components: [homeThing]
  - source:
      type: git
      url: https://github.com/landonr/esphome-components
    refresh: 0s
    components: [ 
      homeassistant_component, # required for all components
      homeassistant_switch_group, # only include if you use switches
      homeassistant_sensor_group, # only include if you use text sensors in menu
      homeassistant_media_player, # only include if you use media players
      homeassistant_service_group, # only include if you want to call services/scripts
      media_player_source, # required for all media player sources
      media_player_source_sonos, # loads sonos favorites into a list
    ]

# don't need to modify past here
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  fast_connect: true
  id: wifi_id
  ap:
    ssid: "${friendly_name} Fallback"
    password: !secret wifi_fallback_password